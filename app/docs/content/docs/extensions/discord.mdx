---
title: Discord Extension
description: Complete guide to integrating Axiomkit agents with Discord servers
---

# Discord Extension

## Overview

The Discord extension enables Axiomkit agents to function as full-featured Discord bots with message handling, slash commands, and server management capabilities.

## Features

- **Message Handling**: Process text messages, reactions, and interactions
- **Slash Commands**: Create and manage Discord slash commands
- **Server Management**: Handle guild events and member interactions
- **Rich Embeds**: Send formatted messages with embeds and components
- **Voice Integration**: Connect to voice channels (coming soon)
- **Permission Management**: Respect Discord role permissions

## Installation

```bash
pnpm add @axiomkit/discord discord.js
```

## Quick Start

```typescript
import { createAgent } from "@axiomkit/core";
import { discord } from "@axiomkit/discord";
import { groq } from "@ai-sdk/groq";

const agent = createAgent({
  model: groq("gemma2-9b-it"),
  extensions: [discord],
});

await agent.start();
```

## Configuration

### Environment Variables

```bash
# Required
DISCORD_TOKEN=your_discord_bot_token
DISCORD_CLIENT_ID=your_client_id

# Optional
DISCORD_GUILD_ID=your_guild_id  # For guild-specific commands
DISCORD_PREFIX=!                # Command prefix (default: !)
```

### Bot Setup

1. **Create Discord Application**
   - Go to [Discord Developer Portal](https://discord.com/developers/applications)
   - Create a new application
   - Navigate to the "Bot" section
   - Create a bot and copy the token

2. **Configure Bot Permissions**
   ```typescript
   const discordExtension = discord({
     intents: [
       GatewayIntentBits.Guilds,
       GatewayIntentBits.GuildMessages,
       GatewayIntentBits.MessageContent,
       GatewayIntentBits.GuildMembers,
     ],
     permissions: [
       PermissionFlagsBits.SendMessages,
       PermissionFlagsBits.ReadMessageHistory,
       PermissionFlagsBits.UseSlashCommands,
     ],
   });
   ```

3. **Invite Bot to Server**
   - Use the OAuth2 URL generator in Discord Developer Portal
   - Select required scopes and permissions
   - Use the generated URL to invite the bot

## Usage Examples

### Basic Message Handling

```typescript
import { discord, discordContext } from "@axiomkit/discord";

const customDiscordContext = discordContext({
  instructions: [
    "You are a helpful Discord bot assistant.",
    "Respond to user messages in a friendly manner.",
    "Use Discord markdown formatting when appropriate.",
  ],
});

const agent = createAgent({
  model: groq("gemma2-9b-it"),
  extensions: [
    discord({
      contexts: {
        discord: customDiscordContext,
      },
    }),
  ],
});
```

### Custom Slash Commands

```typescript
import { action } from "@axiomkit/core";
import { z } from "zod";

const weatherCommand = action({
  name: "weather",
  description: "Get weather information for a location",
  schema: z.object({
    location: z.string().describe("City or location name"),
    units: z.enum(["celsius", "fahrenheit"]).optional().describe("Temperature units"),
  }),
  handler: async (args, ctx, agent) => {
    const { location, units = "celsius" } = args;
    
    // Call weather API
    const weather = await getWeather(location, units);
    
    return {
      embeds: [{
        title: `Weather in ${location}`,
        description: `${weather.temperature}°${units === "celsius" ? "C" : "F"}, ${weather.condition}`,
        color: 0x00ff00,
        fields: [
          { name: "Humidity", value: `${weather.humidity}%`, inline: true },
          { name: "Wind", value: `${weather.windSpeed} km/h`, inline: true },
        ],
      }],
    };
  },
});

const agent = createAgent({
  model: groq("gemma2-9b-it"),
  extensions: [
    discord({
      actions: [weatherCommand],
    }),
  ],
});
```

### Server Management

```typescript
const memberWelcomeAction = action({
  name: "welcome-member",
  description: "Welcome new server members",
  schema: z.object({
    memberId: z.string(),
    memberName: z.string(),
  }),
  handler: async (args, ctx, agent) => {
    const { memberId, memberName } = args;
    
    return {
      embeds: [{
        title: "Welcome! 🎉",
        description: `Welcome ${memberName} to our server!`,
        color: 0x00ff00,
        thumbnail: { url: `https://cdn.discordapp.com/avatars/${memberId}/avatar.png` },
        fields: [
          { name: "Member Count", value: `${ctx.guild?.memberCount}`, inline: true },
          { name: "Join Date", value: new Date().toLocaleDateString(), inline: true },
        ],
      }],
    };
  },
});
```

## Advanced Configuration

### Custom Discord Context

```typescript
import { context } from "@axiomkit/core";
import { z } from "zod";

const customDiscordContext = context({
  type: "discord-server",
  schema: z.object({
    guildId: z.string(),
    channelId: z.string().optional(),
  }),
  key: ({ guildId, channelId }) => `${guildId}:${channelId || "general"}`,
  create: (state) => ({
    messages: [],
    activeUsers: new Set(),
    serverStats: {
      totalMessages: 0,
      activeChannels: [],
    },
  }),
  render: ({ memory, state }) => `
    Discord Server Context:
    Guild ID: ${state.guildId}
    Channel ID: ${state.channelId || "general"}
    Total Messages: ${memory.serverStats.totalMessages}
    Active Users: ${memory.activeUsers.size}
  `,
});
```

### Message Filtering

```typescript
const discordExtension = discord({
  messageFilters: {
    // Only respond to messages in specific channels
    allowedChannels: ["bot-commands", "general"],
    
    // Ignore messages from bots
    ignoreBots: true,
    
    // Custom filter function
    customFilter: (message) => {
      // Only respond to messages starting with "!"
      return message.content.startsWith("!");
    },
  },
});
```

### Rate Limiting

```typescript
const discordExtension = discord({
  rateLimits: {
    messagesPerMinute: 10,
    commandsPerMinute: 5,
    cooldownMs: 1000,
  },
});
```

## Event Handling

### Message Events

```typescript
const messageHandler = action({
  name: "handle-message",
  description: "Handle incoming Discord messages",
  handler: async (args, ctx, agent) => {
    const { message, channel, author } = args;
    
    // Log message
    console.log(`${author.username}: ${message.content}`);
    
    // Update server stats
    ctx.agentMemory.serverStats.totalMessages++;
    ctx.agentMemory.activeUsers.add(author.id);
    
    // Process message content
    if (message.content.includes("hello")) {
      return {
        content: `Hello ${author.username}! 👋`,
      };
    }
    
    return null; // No response
  },
});
```

### Reaction Events

```typescript
const reactionHandler = action({
  name: "handle-reaction",
  description: "Handle message reactions",
  handler: async (args, ctx, agent) => {
    const { reaction, user } = args;
    
    if (reaction.emoji.name === "👍") {
      return {
        content: `Thanks for the thumbs up, ${user.username}!`,
      };
    }
  },
});
```

## Error Handling

```typescript
const robustDiscordExtension = discord({
  errorHandling: {
    // Retry failed operations
    retryAttempts: 3,
    retryDelay: 1000,
    
    // Log errors
    logErrors: true,
    
    // Custom error handler
    onError: (error, context) => {
      console.error("Discord error:", error);
      
      // Send error notification to admin channel
      if (context.channel) {
        context.channel.send({
          embeds: [{
            title: "Error Occurred",
            description: "An error occurred while processing your request.",
            color: 0xff0000,
            timestamp: new Date().toISOString(),
          }],
        });
      }
    },
  },
});
```

## Best Practices

### 1. **Permission Management**
```typescript
// Check permissions before actions
const permissionCheck = action({
  name: "check-permissions",
  handler: async (args, ctx, agent) => {
    const { member, permissions } = args;
    
    if (!member.permissions.has(PermissionFlagsBits.ManageMessages)) {
      return {
        content: "You don't have permission to use this command.",
        ephemeral: true,
      };
    }
    
    // Proceed with action
  },
});
```

### 2. **Message Formatting**
```typescript
// Use Discord markdown and embeds
const formattedResponse = {
  embeds: [{
    title: "Response Title",
    description: "**Bold text** and *italic text*",
    color: 0x00ff00,
    fields: [
      { name: "Field 1", value: "Value 1", inline: true },
      { name: "Field 2", value: "Value 2", inline: true },
    ],
    footer: { text: "Powered by Axiomkit" },
    timestamp: new Date().toISOString(),
  }],
};
```

### 3. **State Management**
```typescript
// Maintain server state in context memory
const serverContext = context({
  type: "discord-server",
  create: (state) => ({
    activeCommands: new Map(),
    userSessions: new Map(),
    serverSettings: {
      prefix: "!",
      welcomeMessage: "Welcome to our server!",
      autoModeration: true,
    },
  }),
});
```

## Troubleshooting

### Common Issues

1. **Bot Not Responding**
   - Check bot token and permissions
   - Verify intents are properly configured
   - Ensure bot is online and connected

2. **Slash Commands Not Working**
   - Register commands with Discord API
   - Check command permissions
   - Verify command structure

3. **Rate Limiting**
   - Implement proper rate limiting
   - Use cooldowns for commands
   - Handle Discord API rate limits

### Debug Mode

```typescript
const debugDiscordExtension = discord({
  debug: true,
  logLevel: "debug",
  verbose: true,
});
```

This comprehensive Discord integration enables Axiomkit agents to provide rich, interactive experiences within Discord servers while maintaining the framework's core capabilities.
